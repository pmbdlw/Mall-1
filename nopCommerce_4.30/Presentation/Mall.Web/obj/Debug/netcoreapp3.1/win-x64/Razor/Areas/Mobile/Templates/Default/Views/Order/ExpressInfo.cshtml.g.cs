#pragma checksum "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\Order\ExpressInfo.cshtml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "2679b157605b8d35d8349f1734b9489526f22d51"
// <auto-generated/>
#pragma warning disable 1591
[assembly: global::Microsoft.AspNetCore.Razor.Hosting.RazorCompiledItemAttribute(typeof(AspNetCore.Areas_Mobile_Templates_Default_Views_Order_ExpressInfo), @"mvc.1.0.view", @"/Areas/Mobile/Templates/Default/Views/Order/ExpressInfo.cshtml")]
namespace AspNetCore
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
#nullable restore
#line 10 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Microsoft.AspNetCore.Mvc.ViewFeatures;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Microsoft.AspNetCore.Html;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Microsoft.AspNetCore.Mvc.Rendering;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Microsoft.AspNetCore.Http.Extensions;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Microsoft.AspNetCore.Mvc;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Microsoft.AspNetCore.Mvc.Razor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Microsoft.AspNetCore.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using System.Net;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using System.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Mall.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 23 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Mall.Web.Framework;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Mall.Web.Framework.Infrastructure;

#line default
#line hidden
#nullable disable
#nullable restore
#line 25 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Mall.DTO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 26 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Mall.Service;

#line default
#line hidden
#nullable disable
#nullable restore
#line 27 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Mall.Core;

#line default
#line hidden
#nullable disable
#nullable restore
#line 28 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Mall.Entities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 30 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\_ViewImports.cshtml"
using Mall.CommonModel;

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"2679b157605b8d35d8349f1734b9489526f22d51", @"/Areas/Mobile/Templates/Default/Views/Order/ExpressInfo.cshtml")]
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"251375f151a8ed74fad18b07a59f5490bcea9ba2", @"/Areas/Mobile/Templates/Default/Views/_ViewImports.cshtml")]
    public class Areas_Mobile_Templates_Default_Views_Order_ExpressInfo : Mall.Web.Framework.MobileWebViewPage<Mall.DTO.Order>
    {
        #pragma warning disable 1998
        public async override global::System.Threading.Tasks.Task ExecuteAsync()
        {
#nullable restore
#line 2 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\Order\ExpressInfo.cshtml"
  
    ViewBag.Title = "物流查询";

#line default
#line hidden
#nullable disable
            WriteLiteral(@"<style>
    .map-box { height: 320px; }
    .container,body{background-color: #fff;}   
</style>
<button id=""btnBackApplet"" onclick=""onBackApplet()"">返回小程序</button>
<div class=""container"">
    <div class=""list-group"">
        <div class=""list-group-item""><span> 运单号码：");
#nullable restore
#line 12 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\Order\ExpressInfo.cshtml"
                                             Write(Model.ShipOrderNumber == null ? string.Empty : Model.ShipOrderNumber);

#line default
#line hidden
#nullable disable
            WriteLiteral(" </span><br><span>物流公司：");
#nullable restore
#line 12 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\Order\ExpressInfo.cshtml"
                                                                                                                                           Write(Model.ExpressCompanyName == null ? string.Empty : Model.ExpressCompanyName);

#line default
#line hidden
#nullable disable
            WriteLiteral(" </span> <a");
            BeginWriteAttribute("name", " name=\"", 514, "\"", 521, 0);
            EndWriteAttribute();
            WriteLiteral(@"></a></div>
        <div class=""list-group-item"" id=""expressDetail"">
            正在加载...
        </div>
        <div class=""qqmapbox"">
            <div class=""map-box"" id=""qqmapcontainer""></div>
        </div>
    </div>
</div>

<input type=""hidden""");
            BeginWriteAttribute("value", " value=\"", 781, "\"", 803, 1);
#nullable restore
#line 22 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\Order\ExpressInfo.cshtml"
WriteAttributeValue("", 789, Model.OrderId, 789, 14, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" id=\"hidOrderId\" />\r\n<input type=\"hidden\"");
            BeginWriteAttribute("value", " value=\"", 845, "\"", 878, 1);
#nullable restore
#line 23 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\Order\ExpressInfo.cshtml"
WriteAttributeValue("", 853, Model.ExpressCompanyName, 853, 25, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" id=\"expressCompanyName\" />\r\n<input type=\"hidden\"");
            BeginWriteAttribute("value", " value=\"", 928, "\"", 958, 1);
#nullable restore
#line 24 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\Order\ExpressInfo.cshtml"
WriteAttributeValue("", 936, Model.ShipOrderNumber, 936, 22, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" id=\"shipOrderNumber\" />\r\n<input type=\"hidden\" id=\"hidIsShowDadaGIS\"");
            BeginWriteAttribute("value", " value=\"", 1027, "\"", 1104, 1);
#nullable restore
#line 25 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\Order\ExpressInfo.cshtml"
WriteAttributeValue("", 1035, Model.DeliveryType== Mall.CommonModel.DeliveryType.CityExpress?1:0, 1035, 69, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" />\r\n<input type=\"hidden\" id=\"hidUserLatlng\"");
            BeginWriteAttribute("value", " value=\"", 1149, "\"", 1208, 1);
#nullable restore
#line 26 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\Order\ExpressInfo.cshtml"
WriteAttributeValue("", 1157, Model.ReceiveLatitude+","+Model.ReceiveLongitude, 1157, 51, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" />\r\n<input type=\"hidden\" id=\"hidStoreLatlng\"");
            BeginWriteAttribute("value", " value=\"", 1254, "\"", 1302, 1);
#nullable restore
#line 27 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\Order\ExpressInfo.cshtml"
WriteAttributeValue("", 1262, ViewBag.StoreLat+","+ViewBag.StoreLng, 1262, 40, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" />\r\n<input type=\"hidden\" id=\"hidBaseURL\"");
            BeginWriteAttribute("value", " value=\"", 1344, "\"", 1403, 1);
#nullable restore
#line 28 "C:\S\nopCommerce_4.30_dev\Presentation\Mall.Web\Areas\Mobile\Templates\Default\Views\Order\ExpressInfo.cshtml"
WriteAttributeValue("", 1352, Mall.Web.Framework.CurrentUrlHelper.CurrentUrl(), 1352, 51, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(@" />
<script type=""text/javascript"" charset=""utf-8"" src=""https://map.qq.com/api/js?v=2.exp""></script>
<script type=""text/javascript"" src=""https://res.wx.qq.com/open/js/jweixin-1.3.2.js""></script>
<script type=""text/javascript"">
	$( function ()
	{
	    //$( '.bonus' ).height( $( '.bonus' ).width() * 39 / 28 )
	    if(window.__wxjs_environment === 'miniprogram'){
	        $(""#btnBackApplet"").show();
	    }
	    else{
	        $(""#btnBackApplet"").hide();
	    }
	} );
	function onBackApplet(){
	    wx.miniProgram.navigateBack();
	}
</script>
<script>

    var expressCompanyName = $('#expressCompanyName').val();
    var shipOrderNumber = $('#shipOrderNumber').val();
    var IsShowDadaGIS = $(""#hidIsShowDadaGIS"").val();

    if (IsShowDadaGIS != 1) {
        $.post('/common/ExpressData/search',
            { expressCompanyName: expressCompanyName, shipOrderNumber: shipOrderNumber },
            function (expressData) {
                if (expressData.success &&expressData.data.length>0) {");
            WriteLiteral(@"
                    var html = '<ul class=""goods_interflow"">';
                    $.each(expressData.data, function (i, data) {
                        var style = '';
                        if (!i) {
                            style = ' class=""active""';
                        }
                        html += ' <li>\
                             <i ' + style + '></i>\
                             <p>' + data.content + '</p>\
                             <p>' + data.time + '</p>\
                                  <hr />\
                         </li>';
                    });
                    html += '</ul>';
                    $('#expressDetail').html(html);
                }
                else {
                    //$('#expressDetail').html('<label class=""red"">' + (expressData.msg?expressData.msg:'') + '</label>');
                    if (expressCompanyName.indexOf('顺丰') == 0) {
                        $('#expressDetail').html('<h4>暂无物流信息，请稍后再试；<a class=""fr blue"" href=""http:");
            WriteLiteral(@"//www.sf-express.com/mobile/cn/sc/dynamic_function/waybill/waybill_query_info.html?billno=' + shipOrderNumber + '"">顺丰官网查询<i class=""glyphicon glyphicon-menu-right""></i></a></h4><br/><p>如有信息推送不及时，请前往物流官网查询！</p>')
                    } else {
                        $('#expressDetail').html('<h4>暂无物流信息，请稍后再试；<a class=""fr blue"" href=""https://m.kuaidi100.com/result.jsp?nu=' + shipOrderNumber + '"">快递100查询<i class=""glyphicon glyphicon-menu-right""></i></a></h4><br/><p>如有信息推送不及时，请前往物流官网查询！</p>')
                    }
                }
            }
        );
    } else {

        var baseurl = $(""#hidBaseURL"").val();
        var map, dadaStatus, riderTips = """", riderDistance = """", targetLatlng;
        var userlatlng = $(""#hidUserLatlng"").val(), storelatlng = $(""#hidStoreLatlng"").val();
        var canShowMap = $(""#hidIsShowDadaGIS"").val() == ""1"";
        var userlat, userlng, storelat, storelng, riderlat, riderlng;
        if (userlatlng.length > 0 && userlatlng.indexOf("","") >= 0) {
            userla");
            WriteLiteral(@"t = parseFloat(userlatlng.split("","")[0]);
            userlng = parseFloat(userlatlng.split("","")[1]);
        }
        if (storelatlng.length > 0 && storelatlng.indexOf("","") >= 0) {
            storelat = parseFloat(storelatlng.split("","")[0]);
            storelng = parseFloat(storelatlng.split("","")[1]);
        }
        canShowMap = canShowMap && !isNaN(userlat) && !isNaN(userlng) && !isNaN(storelat) && !isNaN(storelng);

        if (canShowMap) {
            initShowMap();
        }

        function initShowMap() {
            //处理骑手信息
            $.ajax({
                type: ""get"",
                url: ""/common/ExpressData/searchDada"",
                data: { orderid: $(""#hidOrderId"").val() },
                dataType: ""json"",
                success: function (data) {
                    if (data && data.status == ""success"" && data.result) {
                        dadaStatus = data.result.statusCode;
                        var loginfo = data.result.statusMsg;
               ");
            WriteLiteral(@"         if (dadaStatus == 2) {
                            canShowMap = canShowMap && true;
                            riderTips = ""距商家"";
                            targetLatlng = storelatlng;
                        }
                        if (dadaStatus == 3) {
                            canShowMap = canShowMap && true;
                            riderTips = ""距客户"";
                            targetLatlng = userlatlng;
                        }
                        if (dadaStatus == 2 || dadaStatus == 3 || dadaStatus == 4) {
                            loginfo += ""<br>骑手："" + data.result.transporterName + "","" + data.result.transporterPhone;
                        }
                        $(""#expressDetail"").html(loginfo);
                        if (canShowMap) {
                            riderlat = parseFloat(data.result.transporterLat);
                            riderlng = parseFloat(data.result.transporterLng);
                            if (dadaStatus == 4) {
          ");
            WriteLiteral(@"                      riderlat = userlat;
                                riderlng = userlng;
                            }
                            if (!isNaN(riderlat) && !isNaN(riderlng)) {
                                $.ajax({
                                    type: ""get"",
                                    url: ""/common/ExpressData/GetDistance"",
                                    data: { fromLatLng: targetLatlng, endLatLng: riderlat + "","" + riderlng },
                                    dataType: ""json"",
                                    success: function (data) {
                                        if (data) {
                                            if (data.result > 1000) {
                                                riderDistance = (data.result / 1000).toFixed(2) + ""KM"";
                                            } else {
                                                riderDistance = data.result.toFixed(2) + ""M""
                                            }
 ");
            WriteLiteral(@"                                           $(""#divlogisticsInfo"").hide();
                                            initMap(getMiddelNumber(userlat, riderlat), getMiddelNumber(userlng, riderlng), data.result);
                                        }
                                    }
                                });
                            }
                        }
                    }
                    else {
                        if (data.status == ""fail"") {
                            ShowMsg(data.msg);
                        }
                    }
                }
            });
        }

        function initMap(lat, lng, distance) {
            var zoom = 14;
            if (distance > 4000) {
                zoom = 13;
            }
            if (distance > 40000) {
                zoom = 11;
            }
            if (distance < 1000) {
                zoom = 15;
            }
            var center = new qq.maps.LatLng(lat, lng);
           ");
            WriteLiteral(@" map = new qq.maps.Map(document.getElementById('qqmapcontainer'), {
                center: center,
                zoom: zoom
            });
            addMapMarker(map, new qq.maps.LatLng(userlat, userlng), ""客户"", baseurl + ""/images/icon_map_my.png"", 32, 40);
            addMapMarker(map, new qq.maps.LatLng(storelat, storelng), ""门店"", baseurl + ""/images/icon_map_store.png"", 32, 40);
            if (dadaStatus == 2 || dadaStatus == 3) {
                addMapMarker(map, new qq.maps.LatLng(riderlat, riderlng), riderTips + riderDistance, baseurl + ""/images/icon_map_rider.png"", 40, 50);
            }
            addReloadBtn(map);
        }
        function addReloadBtn(map) {
            var controlDiv = document.createElement(""div"");
            controlDiv.style.padding = ""3px"";
            controlDiv.style.backgroundColor = ""#FFFFFF"";
            controlDiv.style.border = ""1px solid #666"";
            controlDiv.style.margin = ""0 10px 30px 0"";

            controlDiv.index = 1;//设置在当前布局中的位置");
            WriteLiteral(@"
            controlDiv.innerHTML = ""<img src='"" + baseurl + ""/images/posi-icon1.png' width='16'>&nbsp;重新加载"";
            controlDiv.onclick = function () {
                initShowMap();
            };
            map.controls[qq.maps.ControlPosition.BOTTOM_RIGHT].push(controlDiv);
        }
        function addMapMarker(map, latlng, tips, tipsicon, w, h) {
            var marker = new qq.maps.Marker({
                title: tips,
                position: latlng,
                map: map,
            });
            var anchor = new qq.maps.Point(w / 2, h),
                 size = new qq.maps.Size(w, h),
                 origin = new qq.maps.Point(0, 0),
                 markerIcon = new qq.maps.MarkerImage(
             tipsicon,
             size,
             origin,
             anchor
           );
            var label = new qq.maps.Label({
                position: latlng,
                map: map,
                content: tips,
                style: { color: ""#f00"", fontSi");
            WriteLiteral(@"ze: ""12px"", fontWeight: ""bold"", boxshadow: ""3px 4px 3px #aaa"" },
                offset: new qq.maps.Size(-16, h > 40 ? -73 : -62)
            });
            marker.setIcon(markerIcon);
        }
        function getMiddelNumber(one, two) {
            var _tmp;
            if (one > two) {
                _tmp = two;
                two = one;
                one = _tmp;
            }
            _tmp = (two - one) / 2;
            return one + _tmp;
        }
    }


</script>");
        }
        #pragma warning restore 1998
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.ViewFeatures.IModelExpressionProvider ModelExpressionProvider { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IUrlHelper Url { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IViewComponentHelper Component { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IJsonHelper Json { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper<Mall.DTO.Order> Html { get; private set; }
    }
}
#pragma warning restore 1591
